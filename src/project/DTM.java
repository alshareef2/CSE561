package project;

import java.awt.Color;
import java.awt.Dimension;
import java.awt.Point;
import java.util.ArrayList;

import GenCol.entity;
import project.entities.*;
import view.modeling.ViewableAtomic;
import view.modeling.ViewableComponent;
import view.modeling.ViewableDigraph;

public class DTM extends ViewableDigraph {
	public static int PROCS = 3;
	double processing_time = 10;
	ArrayList <Processor> procList;
	
	ViewableAtomic g, tm, tr;
	
	public DTM(){
		this("Twitter Model");
	}

	public DTM(String name) {
		super(name);
		procList = new ArrayList <Processor> ();
		addOutport("OUT");

		g = new RealisticTweetG();
		tm = new TweetCreator();
		tr = new DTransd();
		
		g.setBackgroundColor(Color.cyan);
		tm.setBackgroundColor(Color.pink);
		tr.setBackgroundColor(Color.orange);

		add(g);
		add(tm);
		add(tr);

		//code to allow the user to FORCE returning the stats.
		addInport("putStatsNow");
		addTestInput("putStatsNow", new entity("Getstats"));
		addCoupling(this, "putStatsNow", tm, TweetCreator.IN_RETURNSTATSNOW);

		//code to start the experiment.
		addInport("startExp");
		addTestInput("startExp", new StartExperiment("Small Experiment", 500, 130, 2.0, 1.5, "#a", 1000));
		addTestInput("startExp", new StartExperiment("Large Experiment", 10000, 130, 2.0, 1.5, "#a", 1000));
		addTestInput("startExp", new StartExperiment("Large, Many Tweets Experiment", 10000, 130, 20.0, 15.0, "#a", 1000));
		addCoupling(this, "startExp", g, RealisticTweetG.IN_START);

		//add some test extreme topics
		addInport("extremeTopic");
		addCoupling(this, "extremeTopic", tm, TweetCreator.IN_EXTREMETOPIC);
		addTestInput("extremeTopic", new ExtremeTopicCommand("1", 30.0));

		addCoupling(g, TweetG.OUT_SETTINGS, tm, TweetCreator.IN_CONFIG);
		addCoupling(g, TweetG.OUT_TWTCMD, tm, TweetCreator.IN_TWEETCOMMAND);

		addCoupling(tm, TweetCreator.OUT_TWEET, tr, "lists");
		addCoupling(tr, "stat", this, "OUT");

		addCoupling(this, "startExp", tr, "getExperiment");

	}
	
	/**
	 * @return the procList
	 */
	public ArrayList<Processor> getProcList() {
		return procList;
	}

	/**
	 * @param procList the procList to set
	 */
	public void setProcList(ArrayList<Processor> procList) {
		this.procList = procList;
	}

	public Processor addProcessor(int proc_counter, double duration){
		
		Processor proc = new Processor("P"+proc_counter, this.processing_time);			
		//Add the processor into the list
		procList.add(proc);
			
		return proc;
	}

    /**
     * Automatically generated by the SimView program.
     * Do not edit this manually, as such changes will get overwritten.
     */
    public void layoutForSimView()
    {
        preferredSize = new Dimension(696, 391);
        ((ViewableComponent)withName("TweetCreator")).setPreferredLocation(new Point(137, 174));
        ((ViewableComponent)withName("Real Tweet Gen")).setPreferredLocation(new Point(-65, 128));
        ((ViewableComponent)withName("DTransd")).setPreferredLocation(new Point(300, 59));
    }
}
